:root{
	--bg:#f6f9fc;
	--card:#ffffff;
	--accent:#4f46e5;
	--income:#10b981;
	--expense:#ef4444;
	--muted:#6b7280;
	--glass: rgba(255,255,255,0.6);
	--vh: 1vh; /* updated via JS -> representa 1% de la altura visual */
}

*{box-sizing:border-box;font-family:Inter,Segoe UI,system-ui,Arial;margin:0;padding:0}
body{background:linear-gradient(180deg,var(--bg),#fff);min-height:100vh;color:#0f172a}
.header{padding:24px;text-align:center;position: relative;display:flex;align-items:center;justify-content:center}
.header h1{font-size:1.6rem;color:var(--accent)}
.subtitle{color:var(--muted);margin-top:6px}

.container{max-width:920px;margin:18px auto;padding:16px;display:grid;gap:18px}
.balance-card{display:flex;justify-content:space-between;align-items:center;padding:18px;background:var(--card);border-radius:12px;box-shadow:0 6px 18px rgba(15,23,42,0.06)}
.balance-card h2{margin-bottom:6px;color:var(--muted)}
.balance-amount{font-size:1.8rem;margin:0;color:#111}

.totals{display:flex;gap:12px}
.total{padding:8px 12px;border-radius:8px;background:var(--glass);text-align:center}
.total span{display:block;font-size:0.8rem;color:var(--muted)}
.total strong{display:block;margin-top:6px}
.total.income strong{color:var(--income)}
.total.expense strong{color:var(--expense)}

.form-section, .list-section{background:var(--card);padding:16px;border-radius:12px;box-shadow:0 6px 18px rgba(15,23,42,0.04)}
.form-section h3, .list-section h3{margin-bottom:12px;color:var(--muted)}

form .row{display:flex;gap:10px;flex-wrap:wrap}
form select, form input{padding:10px;border:1px solid #e6e9ef;border-radius:8px;min-width:0}
form input[type="number"]{width:140px}
.actions{justify-content:flex-end}
.btn{padding:10px 14px;border-radius:8px;border:none;cursor:pointer}
.btn.primary{background:var(--accent);color:#fff}
.btn.danger{background:#ffe9e9;color:var(--expense)}

.transactions-list{display:flex;flex-direction:column;gap:8px;max-height:360px;overflow:auto;padding-right:4px}
.transaction{display:flex;justify-content:space-between;align-items:center;padding:10px;border-radius:10px;border:1px solid #f0f2f5}
.tx-left{display:flex;gap:10px;align-items:center}
.avatar{width:44px;height:44px;border-radius:8px;display:flex;align-items:center;justify-content:center;background:#f3f4f6;color:#111;font-weight:600}
.tx-info{display:flex;flex-direction:column}
.tx-desc{font-weight:600}
.tx-meta{font-size:0.85rem;color:var(--muted)}
.tx-amount{font-weight:700}
.tx-amount.income{color:var(--income)}
.tx-amount.expense{color:var(--expense)}
.tx-actions button{background:transparent;border:none;color:var(--muted);cursor:pointer;margin-left:8px}

.footer{text-align:center;padding:16px;color:var(--muted);font-size:0.9rem}

.overlay{
	position:fixed;
	inset:0;
	background:rgba(15,23,42,0.5);
	display:flex;
	align-items:center;
	justify-content:center;
	z-index:50;
}
.auth-card{
	background:var(--card);
	padding:18px;
	border-radius:12px;
	box-shadow:0 10px 30px rgba(2,6,23,0.2);
	width:320px;
	max-width:90%;
}
.hidden{display:none;}

/* Pull-to-refresh */
.pull-refresh{
	position:fixed;
	top:0;
	left:0;
	right:0;
	height:64px;
	display:flex;
	align-items:flex-end;
	justify-content:center;
	pointer-events:none;
	transform:translateY(-64px);
	transition:transform 220ms cubic-bezier(.2,.8,.2,1);
	z-index:9999;
}
.pull-refresh.visible{ pointer-events:auto; }
.pull-refresh.active{ transform:translateY(0); }

/* three-dot loader */
.pull-refresh .dots{ display:flex;gap:8px;padding-bottom:10px;opacity:0;transition:opacity 160ms ease; }
.pull-refresh.active .dots{ opacity:1; }
.pull-refresh .dots span{
	width:10px;height:10px;border-radius:50%;background:var(--accent);display:inline-block;
	transform:translateY(0);
}
/* animación secuencial */
@keyframes bounceDots {
	0%{ transform: translateY(0); opacity:0.6; }
	30%{ transform: translateY(-8px); opacity:1; }
	60%{ transform: translateY(0); opacity:0.8; }
	100%{ transform: translateY(0); opacity:0.6; }
}
.pull-refresh.active .dots span:nth-child(1){ animation: bounceDots 900ms infinite 0ms; }
.pull-refresh.active .dots span:nth-child(2){ animation: bounceDots 900ms infinite 120ms; }
.pull-refresh.active .dots span:nth-child(3){ animation: bounceDots 900ms infinite 240ms; }

/* layout responsive tweaks */
@media (max-width:640px){
	/* chat widget: ocupar más espacio y centrado en móviles */
	#chat-widget{
		right:8px !important;
		left:8px !important;
		bottom:12px !important;
		width:auto !important;
		max-width:calc(100% - 16px);
		height:60% !important;
		border-radius:12px;
	}
	.header{padding:14px}
	.header h1{font-size:1.25rem}
	/* header avatar y controls se colocan en línea y más compactos */
	#header-avatar{left:12px;top:12px;width:36px;height:36px}
	#header-username{left:56px;top:16px}
	#change-photo-btn{left:56px;top:44px}
	.logout-btn{right:12px;top:12px}
	/* botones más cómodos */
	.btn{padding:9px 12px}
	/* main container padding */
	.container{padding:12px}
}

/* Ensure main can be transformed smoothly during pull gesture */
#app-main{
	transform: translateY(0);
	transition: transform 180ms cubic-bezier(.2,.8,.2,1);
}

/* Mejoras visuales para login / registro (auth overlay) */
#auth-overlay { 
	/* mantener overlay existente, añadir respaldo de fondo suave */
	backdrop-filter: blur(6px);
}
.auth-card{
	/* aumentar tamaño y espaciado para mejor legibilidad */
	width:420px;
	padding:22px;
	border-radius:14px;
	box-shadow:0 18px 40px rgba(2,6,23,0.25);
	max-width:92%;
	display:flex;
	flex-direction:column;
	gap:12px;
}

/* Título centrado y más claro */
.auth-card h2{
	margin:0 0 8px 0;
	font-size:1.25rem;
	color:var(--accent);
	text-align:center;
}

/* Layout superior: avatar + controles */
.auth-card > div:first-of-type{
	display:flex;
	gap:12px;
	align-items:center;
}
#auth-avatar{
	width:72px;
	height:72px;
	border-radius:12px;
	object-fit:cover;
	border:1px solid #e6e9ef;
	background:#f3f4f6;
	flex:0 0 72px;
}

/* Inputs y selects dentro del card */
.auth-card select,
.auth-card input[type="text"],
.auth-card input[type="file"],
.auth-card input[type="date"],
.auth-card input[type="number"]{
	width:100%;
	padding:10px 12px;
	border-radius:10px;
	border:1px solid #e6e9ef;
	background:#fff;
	font-size:0.95rem;
	box-shadow:none;
}

/* Agrupar controles del upload para que el botón quede compacto */
.auth-card .upload-row{
	display:flex;
	gap:8px;
	align-items:center;
}
.auth-card .upload-row input[type="file"]{
	flex:1;
	padding:8px 10px;
}
.auth-card .upload-row button{
	flex:0 0 auto;
	padding:8px 10px;
	border-radius:8px;
}

/* Botones: login principal grande y full-width; otros secundarios más discretos */
.auth-card .actions {
	display:flex;
	gap:8px;
	margin-top:6px;
}
.auth-card .actions .btn.primary{
	flex:1;
	padding:12px 14px;
	border-radius:10px;
	font-weight:600;
	background:var(--accent);
	color:#fff;
}
.auth-card .actions .btn{
	flex:0 0 auto;
	padding:10px 12px;
	border-radius:10px;
	background:#f3f4f6;
	color:var(--muted);
	border:1px solid #e6e9ef;
}

/* Input de nuevo usuario y botón de registrar dentro del mismo row */
.auth-card .register-row{
	display:flex;
	gap:8px;
	align-items:center;
}
.auth-card .register-row input{ flex:1; }

/* Ajustes responsive para móviles */
@media (max-width:480px){
	.auth-card{ width: calc(100% - 32px); padding:16px; }
	#auth-avatar{ width:56px; height:56px; flex:0 0 56px; }
	.auth-card .actions .btn.primary{ padding:10px; }
	.auth-card .upload-row{ flex-direction:column; align-items:stretch; }
	.auth-card .upload-row button{ width:100%; }
}

/* Header controls layout (agrupados y responsive para evitar solapamientos) */
.header-avatar { position: absolute; left:16px; top:14px; width:40px; height:40px; border-radius:8px; object-fit:cover; display:none; }
.header-username { position: absolute; left:64px; top:18px; color:var(--muted); display:none; font-weight:600; }

.header-controls {
	position: absolute;
	right:16px;
	top:12px;
	display:flex;
	gap:8px;
	align-items:center;
}

/* Header: distribuir en tres zonas (izquierda usuario, centro título, derecha controles) */
.header {
	position: relative;
	display: flex;
	align-items: center;
	justify-content: center; /* título centrado por defecto */
	gap: 12px;
	padding: 18px 20px;
}

/* zona izquierda: avatar + lápiz + nombre */
.header-user {
	position: absolute;
	left: 16px;
	top: 12px;
	display: flex;
	align-items: center;
}
.header-user-inner { display:flex; align-items:center; gap:8px; }

/* avatar */
.header-avatar {
	width:56px;
	height:56px;
	border-radius:12px;
	object-fit:cover;
	border:1px solid #e6e9ef;
	background:#f3f4f6;
	display:inline-block;
}

/* nombre junto al avatar */
.header-username {
	font-weight:700;
	color:var(--muted);
	margin-left:6px;
	display:inline-block;
}

/* lápiz: pequeño botón al lado del avatar (inline con el nombre) */
/* REEMPLAZADO: ampliar área de toque, ajustar posición y z-index para evitar problemas táctiles */
.change-photo-btn {
	/* inline placement: evitar solapamientos con posicionamientos absolutos previos */
	position: relative !important;
	margin-left: 8px;
	min-width:42px;
	min-height:42px;
	width:42px;
	height:42px;
	border-radius:10px;
	display:inline-flex;
	align-items:center;
	justify-content:center;
	font-size:16px;
	background:#ffffff;
	border:1px solid rgba(0,0,0,0.06);
	box-shadow: 0 8px 20px rgba(2,6,23,0.06);
	cursor:pointer;
	padding:6px;
	line-height:1;
	z-index:1200; /* asegurar que sea clicable encima de otros elementos */
}

/* mantener input siempre oculto */
#change-photo-input { display:none !important; }

/* Evitar definiciones contradictorias posteriores: neutralizar la versión que posicionaba absolute */
.change-photo-btn {
	/* asegurar consistencia en responsive: no usar offset negativos que reduzcan el hit area */
	right: auto !important;
	bottom: auto !important;
}

/* Responsivo: compactar y permitir wrap si es necesario */
@media (max-width:720px) {
	.header { padding:12px 12px; }
	.header-user { left:10px; top:10px; }
	.header-controls { right:10px; top:10px; gap:6px; }
	.header-avatar { width:36px; height:36px; }
	.change-photo-btn { min-width:26px; height:26px; font-size:12px; }
	.header-username { font-size:0.92rem; }
}

/* animación de éxito (pequeño e{stallido) */
.success-burst {
	position:relative;
	pointer-events:none;
}
.success-burst::after{
	content:'';
	position:absolute; inset: -10px; border-radius:14px;
	background: radial-gradient(circle at 30% 20%, rgba(16,185,129,0.12), rgba(16,185,129,0));
	opacity:0; transform:scale(0.85);
	animation: burst 900ms ease-out forwards;
}
@keyframes burst {
	0% { opacity:1; transform:scale(0.85); }
	60% { opacity:0.9; transform:scale(1.05); }
	100%{ opacity:0; transform:scale(1.15); }
}

/* Anotar visualmente programados "ending-soon" en la lista */
.transaction.ending-soon{ border-color: #f59e0b; position:relative; }
.transaction.ending-soon .tx-right { display:flex; flex-direction:column; align-items:flex-end; gap:6px; }
.transaction.ending-soon .soon-label{ font-size:0.8rem; color:#92400e; font-weight:600; }
/* Botón de cambiar foto: pequeño lápiz sobre el avatar */
.change-photo-btn {
	position: absolute;
	right: -6px;
	bottom: -6px;
	width:30px;
	height:30px;
	border-radius:50%;
	display:inline-flex;
	align-items:center;
	justify-content:center;
	font-size:14px;
	background: #ffffff;
	border:1px solid rgba(0,0,0,0.06);
	box-shadow: 0 6px 14px rgba(2,6,23,0.08);
	cursor: pointer;
	padding:0;
	line-height:1;
}

/* mejorar hit area sin mostrar input */
#change-photo-input { display:none !important; }

/* pequeño ajuste en móvil para no tapar avatar */
@media (max-width:640px){
	.change-photo-btn { width:26px; height:26px; font-size:12px; right:-4px; bottom:-4px; }
}

/* Mobile-first tweaks: empujar controles al fondo y evitar que tapen contenido */
@media (max-width:720px){
	/* mover los controles del header a zona inferior fija para accesibilidad en móviles */
	.header-controls {
		position: fixed;
		right: 12px;
		bottom: 12px;
		top: auto;
		gap: 8px;
		background: rgba(255,255,255,0.94);
		padding: 8px;
		border-radius: 12px;
		box-shadow: 0 8px 20px rgba(2,6,23,0.12);
		z-index: 1200;
	}
	/* dejar espacio inferior en el contenido principal para que los controles no lo tapen */
	.container { padding-bottom: 110px; }

	/* compactar header para que quepa el título y avatar */
	.header { padding: 12px 10px; }
	.header h1 { font-size: 1.1rem; }
	.subtitle { display: none; }

	/* formulario: apilar campos para pantallas estrechas */
	form .row { flex-direction: column; align-items: stretch; }
	form input[type="number"]{ width:100% }

	/* reducir margen y tamaño de botones */
	.btn { padding: 8px 10px; font-size: 0.95rem; }
	.btn.primary { padding: 10px 12px; }

	/* chat widget se redimensiona ya definido, asegurarse que no quede debajo de controles */
	#chat-widget { margin-bottom: 140px; }

	/* listado de transacciones: usar padding lateral más pequeño */
	.transactions-list { max-height: 56vh; }
}

/* avatar (header / auth / chat) como círculo con inicial */
.header-avatar,
#auth-avatar,
#chat-user-avatar {
	width:56px;
	height:56px;
	min-width:56px;
	min-height:56px;
	border-radius:12px;
	display:inline-flex;
	align-items:center;
	justify-content:center;
	background:#eef2ff;
	color:#0f172a;
	font-weight:700;
	font-size:1.05rem;
	border:1px solid #e6e9ef;
	box-shadow: 0 2px 6px rgba(2,6,23,0.03);
}

/* tamaño específico para auth avatar (cuando se usó 56px) */
#auth-avatar { width:56px; height:56px; min-width:56px; min-height:56px; border-radius:12px; }

/* ocultar por completo controles de cambio de foto si quedan en el DOM */
.change-photo-btn, #change-photo-input, #auth-photo-input, #auth-upload-photo, #chat-photo-input {
	display:none !important;
	pointer-events:none !important;
	opacity:0 !important;
}

/* asegurar que no se apliquen reglas contradictorias posteriores */
.change-photo-btn { display:none !important; }

/* Chat widget (estilo tipo chatbot) */
#chat-widget {
	/* override inline fallbacks: coordinar posición y entrada */
	display: none; /* controlado por JS */
	position: fixed;
	right: 20px;
	bottom: 20px;
	/* usar porcentaje de la altura visual para que no se tape con teclado */
	height: calc(var(--vh, 1vh) * 80); /* antes: 80vh */
	width: 340px;
	max-width: 96vw;
	max-height: 96vh;
	min-height: 340px;
	display: flex;
	flex-direction: column;
	overflow: hidden;
	background: #fff;
	box-shadow: 0 20px 40px rgba(2,6,23,0.18);
	border: 1px solid rgba(15,23,42,0.04);
	border-radius: 12px;
}

/* Fijar la barra de input dentro del widget para móviles y evitar solapamientos */
#chat-widget .chat-form {
	position: absolute;
	left: 0;
	right: 0;
	bottom: env(safe-area-inset-bottom, 0);
	z-index: 40;
	background: rgba(255,255,255,0.98);
}

/* Asegurar espacio abajo para que los mensajes no queden bajo la barra */
#chat-widget .chat-window {
	padding-bottom: calc(72px + env(safe-area-inset-bottom, 8px));
}

/* En reglas responsivas que antes usaban vh, usar la variable --vh */
@media (max-width:720px){
	#chat-widget {
		right: 8px;
		left: 8px;
		bottom: 12px;
		width: auto;
		max-width: 100vw;
		/* usar variable visual */
		height: calc(var(--vh, 1vh) * 80);
		max-height: 96vh;
		min-height: 220px;
	}
}

/* quick reply chips (por si más adelante se agregan) */
.chat-window .chips { display:flex; gap:8px; flex-wrap:wrap; margin-top:6px; }
.chat-window .chip { background:#fff;border:1px solid #e6e9ef;padding:6px 10px;border-radius:999px;font-size:0.9rem;cursor:pointer;box-shadow:0 6px 16px rgba(2,6,23,0.04);}

/* Messenger-like chat enhancements */
.msg-sent {
	display: inline-block;
	margin-left: 6px;
	color: #aaa;
	font-size: 0.95em;
	vertical-align: middle;
}
.msg-seen {
	display: inline-block;
	margin-left: 6px;
	color: #888;
	font-size: 0.95em;
	vertical-align: middle;
}
.msg-seen-blue {
	color: #2196f3 !important;
	font-weight: bold;
}
.msg-seen-green {
	color: #10b981 !important;
	font-weight: bold;
}
#chat-username {
	transition: color 0.2s;
}

/* Animación de entrada de mensajes (definida correctamente) */
@keyframes slideUpFade {
	from { transform: translateY(8px); opacity:0; }
	to { transform: translateY(0); opacity:1; }
}
.msg { animation: slideUpFade 240ms ease; }
/* ===== ADICIONES: estilos faltantes/overrides ===== */

/* Mostrar lápiz de cambio de foto únicamente dentro del chat-app (override de reglas globales que lo ocultan) */
.chat-app .change-photo-btn {
	display: inline-flex !important;
	pointer-events: auto !important;
	opacity: 1 !important;
	align-items: center;
	justify-content: center;
	width: 34px;
	height: 34px;
	border-radius: 50%;
	background: #fff;
	border: 1px solid rgba(0,0,0,0.06);
	box-shadow: 0 8px 20px rgba(2,6,23,0.08);
	z-index: 1200;
}

/* avatar image inside avatar/author blocks */
.avatar img,
.header-avatar img,
#auth-avatar img,
#chat-user-avatar img {
	width: 100%;
	height: 100%;
	object-fit: cover;
	border-radius: inherit;
	display: block;
}

/* Modal para ver avatar ampliado (general, en caso styles.css se use para la versión standalone) */
.avatar-modal {
	position: fixed;
	inset: 0;
	display: flex;
	align-items: center;
	justify-content: center;
	background: rgba(0,0,0,0.6);
	z-index: 99999;
	padding: 24px;
}
.avatar-modal.hidden { display: none; }
.avatar-modal img {
	max-width: 92vw;
	max-height: 92vh;
	border-radius: 12px;
	object-fit: contain;
	box-shadow: 0 18px 50px rgba(2,6,23,0.6);
	border: 4px solid rgba(255,255,255,0.06);
}

/* Mostrar con pequeña animación */
.avatar-modal.show img { animation: zoomIn 220ms cubic-bezier(.2,.8,.2,1); }
@keyframes zoomIn { from { transform: scale(0.92); opacity: 0; } to { transform: scale(1); opacity: 1; } }

/* Botón eliminar mensaje (cuando se inserta en .msg-body) */
.msg-delete {
	background: transparent;
	border: none;
	cursor: pointer;
	font-size: 14px;
	margin-left: 8px;
	padding: 4px;
	color: #6b7280;
	vertical-align: middle;
}
.msg-delete:hover { color: #111; }

/* Contactos en el widget/chat (si existen) */
.chat-contact {
	display: block;
	width: 100%;
	text-align: left;
	padding: 8px 10px;
	border-radius: 8px;
	background: transparent;
	border: none;
	cursor: pointer;
	color: #0f172a;
	font-weight: 600;
}
.chat-contact.active {
	background: rgba(79,70,229,0.06);
}

/* Badge para pagos programados */
.sched-badge {
	display: inline-block;
	padding: 4px 8px;
	margin-right: 8px;
	border-radius: 999px;
	font-size: 0.75rem;
	font-weight: 700;
	background: #eef2ff;
	color: #1e293b;
}
.sched-badge.due { background: #fff4e6; color: #92400e; }
.sched-badge.soon { background: #fff7ed; color: #92400e; }
.sched-badge.normal { background: #eef2ff; color: #0f172a; }

/* Pequeño ajuste para que los avatars con iniciales se centren bien */
.header-avatar,
#auth-avatar,
#chat-user-avatar,
.avatar {
	display: inline-flex;
	align-items: center;
	justify-content: center;
	overflow: hidden;
}

/* Fin de adiciones */
